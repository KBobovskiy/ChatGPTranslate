(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}const c=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cursorPosition={x:0,y:0}},(e=[{key:"init",value:function(){var t=this;document.addEventListener("mousemove",(function(e){t.cursorPosition={x:e.clientX,y:e.clientY}}))}},{key:"getPosition",value:function(){return n(n({},this.cursorPosition),{},{scrollX:window.scrollX,scrollY:window.scrollY})}}])&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,s(o.key),o)}}function s(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}const u=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"show",value:function(t,e,n){chrome.storage.local.get(["alwaysDisplayExplanation","alwaysDisplayBreakdown"],(function(o){var r=o.alwaysDisplayExplanation||!1,i=o.alwaysDisplayBreakdown||!1,a=document.createElement("div");a.id="translation-popup";var l=c.getPosition(),s=l.x,u=l.y,f=l.scrollX,y=l.scrollY;if(a.style.position="absolute",a.style.top="".concat(u+y,"px"),a.style.left="".concat(s+f,"px"),a.style.backgroundColor="white",a.style.border="1px solid black",a.style.padding="10px",a.style.zIndex="10000",a.innerHTML="<p><strong>Translation:</strong> ".concat(t,"</p>"),r)a.innerHTML+="<p><strong>Explanation:</strong> ".concat(e,"</p>");else{var p=document.createElement("a");p.href="#",p.textContent="See Explanation",p.addEventListener("click",(function(t){t.preventDefault();var n=document.createElement("p");n.innerHTML="<strong>Explanation:</strong> ".concat(e),a.appendChild(n),p.style.display="none"})),a.appendChild(p)}if(i)a.innerHTML+="<p><strong>Breakdown:</strong> ".concat(n,"</p>");else{var b=document.createElement("a");b.href="#",b.textContent="See Breakdown",b.addEventListener("click",(function(t){t.preventDefault();var e=document.createElement("p");e.innerHTML="<strong>Breakdown:</strong> ".concat(n),a.appendChild(e),b.style.display="none"})),a.appendChild(b)}document.body.appendChild(a),document.addEventListener("mousedown",(function t(e){a&&!a.contains(e.target)&&e.target!==m.icon&&(a.remove(),m.hide(),document.removeEventListener("mousedown",t))}))}))}}])&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function y(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,p(o.key),o)}}function p(t){var e=function(t,e){if("object"!=f(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=f(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}const m=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.icon=null},(e=[{key:"init",value:function(){}},{key:"show",value:function(){var t=this;this.icon||(this.icon=document.createElement("img"),this.icon.src=chrome.runtime.getURL("src/icons/icon.png"),this.icon.style.position="absolute",this.icon.style.cursor="pointer",this.icon.style.zIndex="10000",this.icon.style.width="24px",this.icon.style.height="24px",this.icon.addEventListener("click",(function(){return t.onClick()})),document.body.appendChild(this.icon));var e=c.getPosition(),n=e.x,o=e.y,r=e.scrollX,i=e.scrollY;this.icon.style.top="".concat(o+i,"px"),this.icon.style.left="".concat(n+r,"px"),this.icon.style.display="block"}},{key:"hide",value:function(){this.icon&&(this.icon.style.display="none")}},{key:"isVisible",value:function(){return this.icon&&"block"===this.icon.style.display}},{key:"contains",value:function(t){return this.icon&&this.icon.contains(t)}},{key:"onClick",value:function(){var t=this;this.icon.src=chrome.runtime.getURL("src/icons/loading-spinner.gif");var e=window.getSelection().toString().trim();e&&chrome.runtime.sendMessage({action:"translateAndExplain",text:e},(function(e){e.error?(alert("Error fetching translation."),console.error("Error:",e.error)):(t.hide(),t.icon.src=chrome.runtime.getURL("src/icons/icon.png"),u.show(e.translation,e.explanation,e.breakdown))}))}}])&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,v(o.key),o)}}function v(t){var e=function(t,e){if("object"!=b(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=b(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==b(e)?e:e+""}const h=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.selectedText=""},(e=[{key:"init",value:function(){var t=this;document.addEventListener("mouseup",(function(){t.selectedText=window.getSelection().toString().trim(),t.selectedText?m.show():m.hide()})),document.addEventListener("mousedown",(function(t){m.isVisible()&&!m.contains(t.target)&&m.hide()}))}},{key:"getSelectedText",value:function(){return this.selectedText}}])&&d(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());c.init(),h.init(),m.init()})();